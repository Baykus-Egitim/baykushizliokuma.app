<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Baykuş Hızlı Okuma</title>
  <!-- MDB icon -->
  <link rel="icon" href="/app/img/bho_yazısız.png">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/app/css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="/app/css/mdb.min.css">
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="/app/css/style.css">
  <!-- Google material icons -->
  <link href="/app/css/material-design/iconfont/material-icons.css" rel="stylesheet">

  <!-- jQuery -->
  <script type="text/javascript" src="/app/js/jquery.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="/app/js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="/app/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="/app/js/mdb.min.js"></script>
  <!-- Timer.js -->
  <script src="/app/js/easytimer.js/dist/easytimer.js"></script>
  <!-- Anime.js -->
  <script src="/app/js/anime/lib/anime.min.js"></script>
  <!-- Async.js -->
  <script src="/app/js/async.min.js"></script>
  <!-- Hotkeys -->
  <script src="/app/js/hotkeys.min.js"></script>
  <!-- Common scripts -->
  <script src="/app/js/common.js"></script>
  <!-- Templates -->
  <script src="/app/js/navbar.js"></script>
  <script src="/app/js/footer.js"></script>
  <script src="/app/js/modal.js"></script>

  <style>
    html,
    body {
      height: 100vh;
      overflow: hidden;
    }

    #playground {
      font-size: 20px !important;
      font-weight: bold;
    }
  </style>

</head>

<body>
  <!-- Start your project here-->
  <div class="container" style="height: 100vh;">
    <div id="playground" class="row w-100 h-100 justify-content-center border nodisplay m-auto">
      <img src="#" width=25 style="z-index: 0; position: absolute; top: 50%; left:50%; transform: translate(-50%, -50%);">
      <div class="m-auto">
      </div>


    </div>
    <div id="background" class="row d-flex justify-content-center h-100 align-items-center odisplay">
      <div id="logo" class="col-12 text-center ">
        <div id="frames" style="position: relative;">
          <img id="frame" class="visible" src="/app/img/bho_dunya_transparent.png" alt="" srcset="" style="opacity: 0.3;" height=450>
        </div>
      </div>
    </div>
  </div>
  <!-- End your project here-->



  <!-- Footer -->
  <footer class="page-footer font-small teal fixed-bottom odisplay">
    <div class="w-100 h-100">

      <div class="row d-flex justify-content-between h-100 align-items-center odisplay">

        <!-- left -->
        <div class="col">
          <div class="row d-flex justify-content-between h-100 align-items-center">
            <div class="col text-left">
              <nav aria-label="Page navigation example" style="margin-left: -0.5rem; margin-right: 1rem;">
                <ul class="pagination pagination-circle pg-blue my-1">
                  <li class="page-item white-text">
                    <a class="page-link white-text" tabindex="-1">Hız:</a>
                  </li>
                  <li class="page-item active"><a class="speed page-link">1</a></li>
                  <li class="page-item"><a class="speed page-link">2</a></li>
                  <li class="page-item"><a class="speed page-link">3</a></li>
                  <li class="page-item"><a class="speed page-link">4</a></li>
                  <li class="page-item"><a class="speed page-link">5</a></li>
                  <li class="page-item"><a class="speed page-link">6</a></li>
                </ul>
              </nav>
            </div>

            <!-- <div class="col text-center"> -->
            <!-- <div class="switch primary-switch mt-2">
                <label>
                  Harf
                  <input id="char-select" type="checkbox" value=0>
                  <span class="lever mx-2"></span> Sayı
                </label>
              </div> -->
            <!-- </div> -->

            <div class="col">
              <div class="switch primary-switch mt-2">
                <label>
                  Harf
                  <input id="char-select" type="checkbox" value=0>
                  <span class="lever mx-2"></span> Sayı
                </label>
              </div>
            </div>
          </div>

        </div>

        <!-- center -->
        <div class="col-2 text-center">
          <button id="start" class="btn btn-outline-white btn-rounded waves-effect waves-light">Başla!</button>
        </div>

        <!-- right -->
        <div class="col">
          <div class="row d-flex justify-content-between h-100 align-items-center">
            <div class="col">
              <nav aria-label="Page navigation example" style="margin-left: -0.5rem; margin-right: 1rem;">
                <ul class="pagination pagination-circle pg-blue my-1">
                  <li class="page-item white-text">
                    <a class="page-link white-text" tabindex="-1">Seviye:</a>
                  </li>
                  <li class="page-item active"><a class="level page-link">1</a></li>
                  <li class="page-item"><a class="level page-link">2</a></li>
                  <li class="page-item"><a class="level page-link">3</a></li>
                </ul>
              </nav>
            </div>
            <div class="col text-right">
              <img src="/app/img/bho_logo_yazı.png" alt="" srcset="" height=50>
            </div>
          </div>
        </div>

      </div>
    </div>
  </footer> <!-- Footer -->

  <!--Modal: modalPush-->
  <div id="confirmFinish" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-notify" role="document">
      <!--Content-->
      <div class="modal-content text-center">
        <!--Header-->
        <div class="modal-header d-flex justify-content-center default">
          <p class="heading" style="font-weight: bold; color: #2bbbad;">Cevabınız:</p>
        </div>

        <!--Body-->
        <div class="modal-body">
          <i class="fas fa-check fa-4x animated rotateIn mb-4" style="color: red"><span class="mx-2"></span></i>
          <p class="resultInfo"></p>
        </div>

        <!--Footer-->
        <div class="modal-footer flex-center">
          <!-- <div id="finish" class="btn btn-sm btn-default waves-effect waves-light">Tamamladım</div> -->
          <!-- <div id="postpone" type="button" class="btn btn-sm btn-default waves-effect waves-light" data-dismiss="modal">Daha sonra</div> -->
          <!-- <div id="continue" class="btn btn-sm btn-default waves-effect waves-light">Devam et</div> -->
          <div id="okay" class="btn btn-sm btn-default waves-effect waves-light" data-dismiss="modal">Tamam</div>
        </div>
      </div>
      <!--/.Content-->
    </div>
  </div>


  <script type="text/javascript">
    //==================================
    // exercise specific global variables
    //==================================
    const module = Number(window.location.pathname.split("/")[3])
    const exercise = Number(window.location.pathname.split("/")[5])
    const exerciseId = `m${module}e${exercise}`
    document.title = `BHO : Modül ${module}: Egzersiz ${exercise}`
    let user = null
    $.get("/app/user", res => { user = res })

    //==================================
    // generate view
    //==================================
    navbar(module)

    addStartModal2()
    addScoreModal2(false)
    $(document).ready(function () {
      $("#scoreModalIconCheck").removeClass("nodisplay")
    })

    //==================================
    // initial functionalities
    //==================================
    // speed
    var speedLevel = 1
    var durationMax = 2700
    var durationMin = durationMax / 6
    var duration = durationMax
    $(document).ready(function () {
      $('.speed').click(function () {
        speedLevel = Number($(this).text())
        if (speedLevel == 1) duration = 2700
        else if (speedLevel == 2) duration = 2400
        else if (speedLevel == 3) duration = 2100
        else if (speedLevel == 4) duration = 1800
        else if (speedLevel == 5) duration = 1500
        else duration == 1200
      });
    })

    // level
    var level = 1
    $(document).ready(function () {
      $('.level').click(function () {
        level = Number($(this).text())
      });
    })

    // character select
    var charType = "letter"
    $(document).ready(function () {
      $("#char-select").change(function () {
        if (charType == "letter") charType = "number"
        else charType = "letter"
      })
    })


    // modal events
    $(document).ready(function () {
      $("#okay").click(() => {
        $("#answer").val("")
        $("#question").text(``)
        atTheEnd()
      })
    })

    // animation specific events



    //==================================
    // animation
    //==================================
    var gridItemWidth = 100
    var gridItemHeight = 100
    var Ncols = 2
    var Nrows = 2
    var interval = null

    function createGrid() {
      emptyGridItems = []
      if (level == 1) { Ncols = 2; Nrows = 2; }
      else if (level == 2) { Ncols = 4; Nrows = 4; }
      else { Ncols = 6; Nrows = 4; }
      $("#playground > div").addClass("grid")
      $("#playground > div").empty()
      $("#playground > div").css("grid-template-columns", `repeat(${Ncols}, ${gridItemWidth}px)`)
      $("#playground > div").css("grid-template-rows", `repeat(${Nrows}, ${gridItemHeight}px)`)
      for (var i = 0; i < Ncols * Nrows; ++i) {
        $("#playground > div").append(`<span class="text-center my-auto"></span>`)
      }
    }


    function loop() {
      // console.log("Here")
      for (var i = 0; i < $("#playground > div > span").length; ++i) {
        var char = (charType == "letter") ? words1[randomInt(0, words1.length)] : ((level == 1) ? randomInt(0, 10) : randomInt(10, 100))
        $(`#playground > div > span:eq(${i})`).text(char)
      }
    }

    $(document).ready(function () {

      $("#start").click(function () {
        $("nav").addClass("animated fadeOutUp")
        $("footer").addClass("animated fadeOutDown")
        $("#background").addClass("animated zoomOut")
        $(".btn").trigger("blur");

        if (level == 1) $("#playground > img").attr("src", "/app/img/ball-turquoise.svg");
        else if (level == 2) $("#playground > img").attr("src", "/app/img/ball4.svg");
        else $("#playground > img").attr("src", "/app/img/ball6.svg");

        setTimeout(() => {
          $("#background").addClass("nodisplay")
          $("#playground").removeClass("nodisplay")


        }, 500);
        setTimeout(() => {
          // prepare
          iteration = 0
          i = 0
          createGrid()

          // stopper
          stopCallback = null
          isFinished2 = null

          // esc
          hotkeys.unbind('esc');
          hotkeys('esc', function (event, handler) {
            switch (handler.key) {
              case 'esc':
                isFinished = true
                stopCallback("Finish")
                break;
              default: null;
            }
          });

          async.series([

            function (callback) {
              stopCallback = callback
              if (!isFirstRun) setTimeout(callback, 500)
              else {
                $("#startModalCountdown").text(10)
                let timer2 = new easytimer.Timer();
               timer2.start({ precision: 'seconds', countdown: true, startValues: { seconds: 10 } });
                timer2.addEventListener('secondsUpdated', function (e) {
                  $("#startModalCountdown").text(timer2.getTimeValues().seconds);
                });
                timer2.addEventListener('targetAchieved', function (e) {
                  $("#startModal").modal("hide")
                });
                $("#startModal").modal("show")
                $('#startModal').off('hidden.bs.modal')
                $('#startModal').on('hidden.bs.modal', function (e) {
                  setTimeout(callback, 500)
                  timer2.stop()
                });
              }
            },
            function (callback) {
              stopCallback = callback
              loop()
              interval = setInterval(loop, duration)

              timer.start({ precision: 'seconds', countdown: true, startValues: { seconds: 60 } });
              toastr["info"]("60");
              timer.addEventListener('secondsUpdated', function (e) {
                $('.md-toast-message').html(timer.getTimeValues().minutes * 60 + timer.getTimeValues().seconds);
              });
              timer.addEventListener('targetAchieved', function (e) {
                callback()
              });
            },

          ],
            function (err) {
              clearInterval(interval)
              isFinished = true
              if (!err) {
                console.log("Finish")
                isFirstRun = false
                let date = new Date()
                totalTime = timer.getTimeValues().minutes * 60 + timer.getTimeValues().seconds,
                  $.post(`/app/stats`,
                    {
                      exercise: exerciseId,
                      date: date.toLocaleDateString("tr-TR").split(".").join("/"),
                      speedLevel: speedLevel,
                      level: level,
                      charType: (charType == "letter") ? "Harf" : "Sayı"
                    },
                    res => {
                      updateScoreTable()
                    })

                // $("#scoreModalInfo").text(`Tamamlama süreniz: ${totalTime} saniye`)
                $("#scoreModal").modal("show")
              }
              timer.stop()
              toastr.clear()
              atTheEnd()
            }
          )



        }, 1000);
      })


    })
    function atTheEnd() {
      $("#playground > div > span").text("")
      $("#playground").removeClass("grid")
      $("#playground").addClass("nodisplay")

      $("nav").removeClass("animated fadeOutUp")
      $("nav").addClass("animated fadeInDown")
      $("footer").removeClass("animated fadeOutDown")
      $("footer").addClass("animated fadeInUp")
      $("#background").removeClass("nodisplay")
      $("#background").removeClass("animated zoomOut")
      $("#background").addClass("animated zoomIn")
    }

  </script>

</body>

</html>