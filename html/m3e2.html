<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Baykuş Hızlı Okuma</title>
  <!-- MDB icon -->
  <link rel="icon" href="/app/img/bho_yazısız.png">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/app/css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="/app/css/mdb.min.css">
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="/app/css/style.css">
  <!-- Google material icons -->
  <link href="/app/css/material-design/iconfont/material-icons.css" rel="stylesheet">


  <!-- jQuery -->
  <script type="text/javascript" src="/app/js/jquery.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="/app/js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="/app/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="/app/js/mdb.min.js"></script>
  <!-- Timer.js -->
  <script src="/app/js/easytimer.js/dist/easytimer.js"></script>
  <!-- Anime.js -->
  <script src="/app/js/anime/lib/anime.min.js"></script>
  <!-- Async.js -->
  <script src="/app/js/async.min.js"></script>
  <!-- Hotkeys -->
  <script src="/app/js/hotkeys.min.js"></script>
  <!-- Common scripts -->
  <script src="/app/js/common.js"></script>
  <!-- Templates -->
  <script src="/app/js/navbar.js"></script>
  <script src="/app/js/footer.js"></script>
  <script src="/app/js/modal.js"></script>

  <style>

  </style>

</head>

<body>


  <!-- Start your project here-->
  <div class="container" style="height: 100%;">
    <div id="playground" class="row w-100 justify-content-center odisplay border nodisplay" style="height: calc( 100% - 50px) !important;">

    </div>
    <div id="background" class="row d-flex justify-content-center h-100 align-items-center odisplay">
      <div id="logo" class="col-12 text-center ">
        <div id="frames" style="position: relative;">
          <img id="frame" class="visible" src="/app/img/bho_dunya_transparent.png" alt="" srcset="" style="opacity: 0.3;" height=450>
        </div>
      </div>
    </div>
  </div>
  <!-- End your project here-->



  <!-- Footer -->
  <footer class="page-footer font-small teal fixed-bottom odisplay">
    <div class="w-100 h-100">

      <div class="row d-flex justify-content-between h-100 align-items-center nodisplay">
        <!-- left -->
        <div class="col">

        </div>

        <!-- center -->
        <div class="col-8 text-center">
          <div class="row d-flex justify-content-center">
            <div id="question" class="col-4 h5 my-auto text-right">
              Toplam kaç adet xx var?
            </div>
            <div class="col-2 my-auto">
              <input type="number" id="answer" class="form-control form-control-sm">
            </div>
            <div class="col-4 my-auto text-left">
              <button id="answerFinish" class="btn btn-sm btn-outline-white btn-rounded waves-effect waves-light">Cevapla</button>
            </div>
          </div>
        </div>

        <!-- right -->
        <div class="col">
          <div class="col text-right">
            <img src="/app/img/bho_logo_yazı.png" alt="" srcset="" height=50>
          </div>
        </div>
      </div>

      <div class="row d-flex justify-content-between h-100 align-items-center odisplay">

        <!-- left -->
        <div class="col">
          <div class="row d-flex justify-content-between h-100 align-items-center">
            <div class="col text-left">
              <nav aria-label="Page navigation example" style="margin-left: -0.5rem; margin-right: 1rem;">
                <ul class="pagination pagination-circle pg-blue my-1">
                  <li class="page-item white-text">
                    <a class="page-link white-text" tabindex="-1">Süre:</a>
                  </li>
                  <li class="page-item active"><a class="speed page-link">1</a></li>
                  <li class="page-item"><a class="speed page-link">2</a></li>
                  <li class="page-item"><a class="speed page-link">3</a></li>
                  <li class="page-item"><a class="speed page-link">4</a></li>
                  <li class="page-item"><a class="speed page-link">5</a></li>
                  <li class="page-item"><a class="speed page-link">6</a></li>
                </ul>
              </nav>
            </div>

            <div class="col text-center">
            </div>

            <div class="col"></div>
          </div>

        </div>

        <!-- center -->
        <div class="col-2 text-center">
          <button id="start" class="btn btn-outline-white btn-rounded waves-effect waves-light">Başla!</button>
        </div>

        <!-- right -->
        <div class="col">
          <div class="row d-flex justify-content-between h-100 align-items-center">
            <div class="col">
              <nav aria-label="Page navigation example" style="margin-left: -0.5rem; margin-right: 1rem;">
                <ul class="pagination pagination-circle pg-blue my-1">
                  <li class="page-item white-text">
                    <a class="page-link white-text" tabindex="-1">Seviye:</a>
                  </li>
                  <li class="page-item active"><a class="level page-link">1</a></li>
                  <li class="page-item"><a class="level page-link">2</a></li>
                  <li class="page-item"><a class="level page-link">3</a></li>
                  <li class="page-item"><a class="level page-link">4</a></li>
                </ul>
              </nav>
            </div>
            <div class="col nodisplay">
              <a href="#"> <i class="fas fa-chart-line fa-2x"></i></a>
            </div>
            <div class="col text-right">
              <img src="/app/img/bho_logo_yazı.png" alt="" srcset="" height=50>
            </div>
          </div>
        </div>

      </div>
    </div>
  </footer> <!-- Footer -->

  <!--Modal: modalPush-->
  <div id="confirmFinish" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-notify" role="document">
      <!--Content-->
      <div class="modal-content text-center">
        <!--Header-->
        <div class="modal-header d-flex justify-content-center default">
          <p class="heading" style="font-weight: bold; color: #2bbbad;">Cevabınız:</p>
        </div>

        <!--Body-->
        <div class="modal-body">
          <i class="fas fa-check fa-4x animated rotateIn mb-4" style="color: red"><span class="mx-2"></span></i>
          <p class="resultInfo"></p>
        </div>

        <!--Footer-->
        <div class="modal-footer flex-center">
          <div id="continue" class="btn btn-sm btn-default waves-effect waves-light" data-dismiss="modal">Devam et</div>
          <div id="okay" class="btn btn-sm btn-default waves-effect waves-light" data-dismiss="modal">Tamamla</div>
        </div>
      </div>
      <!--/.Content-->
    </div>
  </div>


  <script type="text/javascript">


    //==================================
    // generate view
    //==================================
    navbar(module)

    addStartModal2()
    addScoreModal2(false)
    $(document).ready(function () {
      $("#scoreModalIconCheck").removeClass("nodisplay")
    })

    //==================================
    // initial functionalities
    //==================================
    // speed
    var speedLevel = 1
    var durationMax = 6000
    var durationMin = durationMax / 6
    var duration = durationMax
    $(document).ready(function () {
      $('.speed').click(function () {
        speedLevel = Number($(this).text())
        duration = durationMin * (7 - speedLevel)
      });
    })

    // word count
    var level = 1
    $(document).ready(function () {
      $('.level').click(function () {
        level = Number($(this).text())
        // toastr["info"](wordCount);
      });
    })


    // modal events
    $(document).ready(function () {
      $("#okay").click(() => {
        $("#answer").val("")
        $("#question").text(``)
        stopCallback()
      })
      $("#continue").click(() => {
        $("#answer").val("")
        $("#question").text(``)
        timer.stop()
        toastr.clear()
        atTheEnd()
        $("#start").trigger("click")
      })
    })

    // animation specific events
    $(document).ready(function () {
      $("#answerFinish").click(() => {
        if (Number($("#answer").val()) == focusCharsLength) {
          $("#confirmFinish > div > div > .modal-body > i").removeClass("fa-times")
          $("#confirmFinish > div > div > .modal-body > i").addClass("fa-check")
          $("#confirmFinish > div > div > .modal-body > i").css("color", "green")
          $("#confirmFinish > div > div > .modal-body > i > span").text("Doğru")
          $("#confirmFinish > div > div > .modal-body > p").text(`Süre: ${timer.getTimeValues().minutes * 60 + timer.getTimeValues().seconds} saniye`)

        }
        else {
          $("#confirmFinish > div > div > .modal-body > i").removeClass("fa-check")
          $("#confirmFinish > div > div > .modal-body > i").addClass("fa-times")
          $("#confirmFinish > div > div > .modal-body > i").css("color", "red")
          $("#confirmFinish > div > div > .modal-body > i > span").text("Yanlış")
          $("#confirmFinish > div > div > .modal-body > p").html(`Toplamda ${focusCharsLength} tane olacaktı!`)
        }
        let date = new Date()
        let totalTime = timer.getTimeValues().minutes * 60 + timer.getTimeValues().seconds
        $.post(`/app/stats`,
          {
            exercise: exerciseId,
            date: date.toLocaleDateString("tr-TR").split(".").join("/"),
            speedLevel: speedLevel,
            level: level,
            duration: totalTime,
            score: Number($("#answer").val()) == focusCharsLength ? "Doğru" : "Yanlış",
          },
          res => {
            updateScoreTable()
          })
        timer.stop()
        $('#confirmFinish').modal("show")
      })
    })


    //==================================
    // animation
    //==================================
    var gridItemWidth = 40
    var gridItemHeight = 40
    var emptyGridItems = []
    var numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
    var focusCharsLength = 0

    function createGrid() {
      emptyGridItems = []
      $("#playground").addClass("grid")
      $("#playground").empty()
      var Ncols = Math.floor($("#playground").width() / gridItemWidth)
      var Nrows = Math.floor($("#playground").height() / gridItemHeight)
      $("#playground").css("grid-template-columns", `repeat(${Ncols}, ${gridItemWidth}px)`)
      $("#playground").css("grid-template-rows", `repeat(${Nrows}, ${gridItemHeight}px)`)
      for (var i = 0; i < Ncols * Nrows; ++i) {
        $("#playground").append(`<span class="text-center my-auto"></span>`)
        emptyGridItems.push(i)
      }
    }

    function hideGridChars() {
      for (var i = 0; i < $(`#playground > span`).length; ++i) {
        $(`#playground > span:eq(${i})`).text(`?`)
      }
    }

    function loop() {
      var characters = (Math.random() < 0.5) ? words1 : numbers
      createGrid()
      $(`#playground > span`).text("")
      $(`#answer`).focus()
      var otherCharCount = 0
      var focusChars = []
      if (level == 1) {
        focusCharsLength = randomInt(1, 5)
        otherCharCount = 10;
        focusChars = [characters[randomInt(0, characters.length)]];
        $("#question").html(`Toplamda kaç tane <strong>${focusChars[0]}</strong> var?`)
      }
      else if (level == 2) {
        focusCharsLength = randomInt(2, 5)
        otherCharCount = 15;
        focusChars = [words1[randomInt(0, words1.length)], numbers[randomInt(0, numbers.length)]];
        $("#question").html(`Toplamda kaç tane  <strong>${focusChars[0]}</strong> ve  <strong>${focusChars[1]}</strong> var?`)
      }
      else if (level == 3) {
        focusCharsLength = randomInt(5, 10)
        otherCharCount = 15;
        focusChars = [words1[randomInt(0, words1.length)], numbers[randomInt(0, numbers.length)]];
        $("#question").html(`Toplamda kaç tane  <strong>${focusChars[0]}</strong> ve  <strong>${focusChars[1]}</strong> var?`)
      }
      else {
        focusCharsLength = randomInt(5, 10)
        otherCharCount = 20;
        var char1 = words1[randomInt(0, words1.length)]
        var char2 = numbers[randomInt(0, numbers.length)]
        var char3 = words1[randomInt(0, words1.length)]
        var char4 = numbers[randomInt(0, numbers.length)]
        while (char3 == char1) char3 = words1[randomInt(0, words1.length)]
        while (char2 == char4) char2 = numbers[randomInt(0, numbers.length)]
        focusChars = [char1, char2, char3, char4];
        $("#question").html(`Toplamda kaç tane  <strong>${focusChars[0]}, ${focusChars[1]}, ${focusChars[2]}</strong> ve  <strong>${focusChars[3]}</strong> var?`)
      }
      for (var i = 0; i < focusCharsLength; ++i) {
        var gridItemIndex = randomInt(0, emptyGridItems.length)
        $(`#playground > span:eq(${emptyGridItems[gridItemIndex]})`).text(focusChars[i % focusChars.length])
        emptyGridItems.splice(emptyGridItems.indexOf(emptyGridItems[gridItemIndex]), 1)
      }
      for (var i = 0; i < otherCharCount; ++i) {
        var gridItemIndex = randomInt(0, emptyGridItems.length)
        var diffChar = characters[randomInt(0, characters.length)]
        while (focusChars.indexOf(diffChar) > -1) diffChar = characters[randomInt(0, characters.length)]
        $(`#playground > span:eq(${emptyGridItems[gridItemIndex]})`).text(diffChar)
        emptyGridItems.splice(emptyGridItems.indexOf(emptyGridItems[gridItemIndex]), 1)
      }
      // console.log(focusChars)
      // console.log(focusCharsLength)
    }


    $(document).ready(function () {


      $("#start").click(function () {
        $("nav").addClass("animated fadeOutUp")
        $("#background").addClass("animated zoomOut")
        $(".btn").trigger("blur");

        setTimeout(() => {
          $("#background").addClass("nodisplay")
          // $("footer > div > div:eq(1)").removeClass("animated fadeInUp")
          // $("footer > div > div:eq(1)").addClass("animated fadeOutDown")
          $("footer > div > div:eq(1)").addClass("nodisplay")
          $("footer > div > div:eq(0)").removeClass("nodisplay")
          // $("footer > div > div:eq(0)").removeClass("animated fadeOutDown")
          // $("footer > div > div:eq(0)").addClass("animated fadeInUp")

          $("#playground").removeClass("nodisplay")


        }, 500);
        setTimeout(() => {

          // prepare
          iteration = 0
          i = 0

          // stopper
          stopCallback = null
          isFinished2 = null

          // esc
          hotkeys.unbind('esc');
          hotkeys('esc', function (event, handler) {
            switch (handler.key) {
              case 'esc':
                isFinished = true
                stopCallback("Finish")
                break;
              default: null;
            }
          });

          async.series([

            function (callback) {
              stopCallback = callback
              if (!isFirstRun) setTimeout(callback, 500)
              else {
                $("#startModalCountdown").text(10)
                let timer2 = new easytimer.Timer();
               timer2.start({ precision: 'seconds', countdown: true, startValues: { seconds: 10 } });
                timer2.addEventListener('secondsUpdated', function (e) {
                  $("#startModalCountdown").text(timer2.getTimeValues().seconds);
                });
                timer2.addEventListener('targetAchieved', function (e) {
                  $("#startModal").modal("hide")
                });
                $("#startModal").modal("show")
                $('#startModal').off('hidden.bs.modal')
                $('#startModal').on('hidden.bs.modal', function (e) {
                  setTimeout(callback, 500)
                  timer2.stop()
                });
              }
            },
            function (callback) {
              stopCallback = callback
              loop()
              setTimeout(hideGridChars, duration)

              timer.start({ precision: 'seconds' });
            },

          ],
            function (err) {
              clearInterval(interval)
              isFinished = true
              if (!err) {
                console.log("Finish")
                isFirstRun = false
                // let date = new Date()
                // totalTime = timer.getTimeValues().minutes * 60 + timer.getTimeValues().seconds,
                //   $.post(`/app/stats`,
                //     {
                //       exercise: exerciseId,
                //       date: date.toLocaleDateString("tr-TR").split(".").join("/"),
                //       speedLevel: speedLevel,
                //       level: wordCount - 1,
                //     },
                //     res => {
                //       updateScoreTable()
                //     })

                // $("#scoreModalInfo").text(`Tamamlama süreniz: ${totalTime} saniye`)
                $("#scoreModal").modal("show")
              }
              timer.stop()
              toastr.clear()
              atTheEnd()
            }
          )


        }, 1000);
      })


    })
    function atTheEnd() {
      $("#playground > span").text("")
      $("#playground").removeClass("grid")
      $("#playground").addClass("nodisplay")

      $("nav").removeClass("animated fadeOutUp")
      $("nav").addClass("animated fadeInDown")
      // $("footer > div > div:eq(0)").addClass("animated fadeOutDown")
      $("footer > div > div:eq(0)").addClass("nodisplay")
      // $("footer > div > div:eq(0)").removeClass("animated fadeInUp")
      $("footer > div > div:eq(1)").removeClass("nodisplay")
      // $("footer > div > div:eq(1)").addClass("animated fadeInUp")
      // $("footer > div > div:eq(1)").removeClass("animated fadeOutDown")
      $("#background").removeClass("nodisplay")
      $("#background").removeClass("animated zoomOut")
      $("#background").addClass("animated zoomIn")
    }

  </script>

</body>

</html>